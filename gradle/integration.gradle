tasks.register('integration', Test) {
  description = "Runs integration tests against docker-compose stack"
  group = "Verification"

  mustRunAfter tasks.named('test')

  testClassesDirs = sourceSets.integrationTest.output.classesDirs
  classpath       = sourceSets.integrationTest.runtimeClasspath
  useJUnitPlatform()

  dependsOn tasks.composeUp
  finalizedBy tasks.composeDown

  jvmArgs = ['-Xshare:off']
  testLogging {
    events "passed", "skipped", "failed"
    exceptionFormat = 'full'
    showStandardStreams = true
  }
}